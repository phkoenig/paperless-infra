# ğŸ“‹ Paperless-NGX Projekt - Cursor AI Regeln

## ğŸ—‚ï¸ Ordnerstruktur-Regeln

### Root-Verzeichnis
- âœ… **NUR** diese Dateien im Root:
  - `README.md` - Haupt-Dokumentation
  - `.gitignore` - Git-Konfiguration
  - `.cursorrules` - Diese Datei
  - `.clasp.json` - Google Apps Script Config
- âŒ **KEINE** Dokumentations-Dateien (gehÃ¶ren nach `docs/`)
- âŒ **KEINE** Scripts oder temporÃ¤re Dateien
- âŒ **KEINE** Infrastruktur-Konfigurationen (gehÃ¶ren nach `infra/`)

### Dokumentation (`docs/`)
- âœ… **ALLE** Dokumentationen nach `docs/` mit Unterordnern:
  - `docs/setup/` - Setup & Konfiguration (SSH, Google Accounts, Deployment)
  - `docs/architecture/` - Architektur & Workflow (Complete Workflow, Deduplication, Galaxy System)
  - `docs/development/` - Entwicklung & Admin (MCP Administration, Email Filter, Usage)
  - `docs/planning/` - Planung & Status (Deployment Plan, Status, Logs)
- âœ… Format: `README_Topic.md` fÃ¼r alle Dokumentationen
- âœ… `docs/README.md` als Navigation/Ãœbersicht
- âŒ **KEINE** Docs auÃŸerhalb von `docs/` (auÃŸer Haupt-`README.md`)

### Infrastruktur (`infra/`)
- âœ… Docker Compose, Caddy, eml2pdf, invoice-ai, rclone
- âœ… Server-Konfigurationen (`cloud-init.yaml`, `.env` Files)
- âœ… Alle Service-spezifischen Dockerfiles und Configs

### Scripts (`scripts/`)
- âœ… Alle Automation-Scripts
- âœ… Unterordner fÃ¼r grÃ¶ÃŸere Script-Projekte
- âœ… Eigene README.md in jedem Script-Ordner

### TemporÃ¤re Dateien
- âœ… **Analyse-Dateien** â†’ `temp/`
- âœ… **Test-Scripts** â†’ `tests/`
- âœ… **Beispiele** â†’ `examples/`
- âœ… **Ideen/Planungen (future work)** â†’ `ideas/`
- âœ… **Veraltete Dateien** â†’ `archive/`
- âŒ **NIEMALS** im Root ablegen!

---

## ğŸ”§ Entwicklungs-Regeln

### Git & Version Control
- âœ… **IMMER** vor Commit User fragen
- âœ… Beschreibende Commit-Messages (Deutsch/Englisch gemischt OK)
- âœ… Nach grÃ¶ÃŸeren Ã„nderungen: User an Commit erinnern
- âœ… **Verwende normale Git-Befehle** (`git add`, `git commit`, `git push`)
- âŒ **NIEMALS GitHub CLI (`gh`)** verwenden - hÃ¤ngt hÃ¤ufig im Terminal!
- âŒ **NIEMALS** `--force` ohne explizite BestÃ¤tigung
- âŒ **NIEMALS** `.env` Dateien committen

### Python-Entwicklung
- âœ… **IMMER** `uv` statt `pip` verwenden
- âœ… venv des aktuellen Projekts aktivieren
- âœ… `requirements.txt` nur im Root-Ordner
- âœ… Kleine, fokussierte Module (<200-300 Zeilen)

### Paperless Administration
- âœ… **Paperless MCP** fÃ¼r Paperless-Administration verwenden
- âœ… MCP Tools: `mcp_paperless_*` fÃ¼r alle Paperless-Operationen
- âŒ SSH nur fÃ¼r Server-Wartung (nicht fÃ¼r Paperless-Verwaltung)
- âŒ **KEINE** Django Shell Befehle direkt

### Code-Stil & Best Practices
- âœ… "Do One Thing and Do It Right" - kleine, fokussierte Module
- âœ… Eine Ã„nderung pro Commit
- âœ… Nach Ã„nderungen: Tests durchfÃ¼hren
- âœ… Bestehenden Code iterieren statt neu schreiben
- âŒ **KEINE** Codeduplikation
- âŒ **KEINE** Dateien >200-300 Zeilen (refaktorisieren!)
- âŒ **KEINE** Mock-Daten in dev/prod Code

### Arbeitsablauf
- âœ… Nach Ã„nderungen Server neu starten zum Testen
- âœ… Vor neuem Server-Start: alte Server beenden
- âœ… Nur Code Ã¤ndern in geÃ¶ffneten Dateien (sonst User fragen)
- âœ… Schrittweise vorgehen - keine autonomen Aktionen
- âŒ **NIEMALS** `.env` Ã¼berschreiben ohne BestÃ¤tigung

---

## ğŸ“š Dokumentations-Regeln

### Neue Dokumentation erstellen
- âœ… In `docs/` mit passender Kategorie (setup/architecture/development/planning)
- âœ… Format: `README_Topic.md`
- âœ… In `README.md` und `docs/README.md` verlinken
- âœ… Klare Struktur mit Emojis fÃ¼r bessere Lesbarkeit
- âŒ **NICHT** im Root erstellen

### Dokumentation aktualisieren
- âœ… Immer prÃ¼fen, ob Docs noch aktuell sind
- âœ… WidersprÃ¼chliche Infos korrigieren
- âœ… Veraltete Docs nach `archive/` verschieben
- âŒ **NICHT** einfach lÃ¶schen (Archiv behalten!)

### Dokumentations-Konventionen
- âœ… Deutsch/Englisch gemischt ist OK (wie User spricht)
- âœ… Code-BlÃ¶cke mit Syntax-Highlighting
- âœ… Emojis fÃ¼r visuelle Struktur
- âœ… Links zu verwandten Dokumentationen

---

## ğŸ¯ Projekt-Spezifisches

### Gmail to Paperless Workflow (v4.2)
**Aktueller Stand:**
- Gmail â†’ `.eml` Export (Google Apps Script v4.2)
- Google Drive â†’ rclone sync â†’ Hetzner Server
- eml2pdf Service â†’ PDF Konvertierung (Gotenberg)
- Paperless-NGX Import mit OCR

**ZWEI Google Accounts:**
1. `philip@zepta.com` (ZEPTA - ArchitekturbÃ¼ro Workspace - gdrive-philip)
2. `phkoenig@gmail.com` (PRIVAT - gdrive-office)

**MASTER Script:**
- Location: `scripts/master-gmail-to-paperless/`
- Version: v4.2 mit `.eml` Export
- Deployment: Ãœber `.clasp.json` & clasp push/deploy

### Deduplication (3 Ebenen)
1. **Apps Script:** Folder-Existenz-Check (verhindert re-export)
2. **Metadata JSON:** RFC Message-ID & SHA-256 Hashes
3. **Paperless:** Native Content-Hash Deduplication

**Wichtig:** "Failed imports" sind oft erfolgreiche Duplikaterkennung!

### Folder Structure Rules
**Google Drive (Source):**
```
Paperless-Emails/
â””â”€â”€ {timestamp}_{from}_{subject}/
    â”œâ”€â”€ email.eml
    â”œâ”€â”€ email-metadata.json
    â””â”€â”€ [attachments...]
```

**Server (via rclone):**
```
/data/emails/ 
â””â”€â”€ (gleiche Struktur wie Google Drive)
```

**Paperless Consume:**
```
/usr/src/paperless/consume/
â””â”€â”€ [flattened PDFs with metadata]
```

### Galaxy System KI Navigation
- **Status:** Zukunftsprojekt - **BEHALTEN!**
- **Ziel:** AI-gesteuerte intelligente Dokumentenzuordnung
- **Location:** `docs/architecture/README_GALAXY_SYSTEM_KI_NAVIGATION.md`
- âŒ **NICHT** archivieren oder lÃ¶schen!

### Technologie-Stack
- **Server:** Hetzner VPS mit Docker Compose
- **Reverse Proxy:** Caddy
- **Document Management:** Paperless-NGX
- **Email Processing:** Google Apps Script v4.2
- **File Sync:** rclone (Google Drive â†’ Server)
- **PDF Conversion:** eml2pdf + Gotenberg
- **Admin Interface:** Paperless MCP (Python & TypeScript)
- **Filter Logic:** Supabase (Whitelist/Blacklist)

---

## ğŸš« Dinge, die NIEMALS getan werden sollten

1. âŒ Dokumentations-Dateien im Root ablegen
2. âŒ GroÃŸe Dateien (>300 Zeilen) ohne Refactoring
3. âŒ Code duplizieren statt refaktorisieren
4. âŒ SSH fÃ¼r Paperless-Administration (verwende MCP!)
5. âŒ `.env` Dateien committen oder Ã¼berschreiben
6. âŒ `pip` verwenden (immer `uv`!)
7. âŒ Veraltete Dokumentation lÃ¶schen (nach archive/ verschieben!)
8. âŒ Galaxy System Dokumentation entfernen
9. âŒ Mock-Daten in dev/prod Code
10. âŒ Ohne User-BestÃ¤tigung commiten
11. âŒ Git force push ohne explizite Erlaubnis
12. âŒ Code in nicht geÃ¶ffneten Dateien Ã¤ndern

---

## ğŸ‘¤ User-PrÃ¤ferenzen (Philip)

- **Sprache:** Deutsch/Englisch gemischt (wie es passt)
- **Ansprache:** Du
- **Arbeitsstil:** Schrittweise, keine autonomen Aktionen
- **Tool-PrÃ¤ferenzen:** 
  - Git: GitHub CLI (`gh`)
  - Python: `uv` Package Manager
  - Dev Server: `npm run dev`
- **Code-Organisation:** Sauber, minimal, "Do One Thing Right"
- **Root-Verzeichnis:** Immer aufgerÃ¤umt und professionell

---

## ğŸ“ Notizen fÃ¼r AI-Sessions

Wenn du als AI-Agent in diesem Projekt arbeitest:

1. **START_HERE.md lesen:** `onboarding/START_HERE.md` enthÃ¤lt vollstÃ¤ndige Projekt-Details
2. **MCP verwenden:** FÃ¼r Paperless-Operationen IMMER Paperless MCP Tools nutzen
3. **Ordnung halten:** Root-Verzeichnis sauber halten, Docs in `docs/`, Temp in `temp/`
4. **User fragen:** Bei Unklarheiten lieber fragen als raten
5. **Dokumentation aktualisieren:** Nach grÃ¶ÃŸeren Ã„nderungen Docs prÃ¼fen und aktualisieren
6. **Galaxy System beachten:** Nicht lÃ¶schen - ist wichtig fÃ¼r zukÃ¼nftige Features!
7. **Git-Befehle:** Nur normale Git-Befehle nutzen, NIEMALS `gh` CLI (hÃ¤ngt hÃ¤ufig)

---

_Diese Regeln wurden am 17.10.2025 erstellt und reflektieren den aktuellen Stand des Projekts (v4.2)._

